<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creating an Adapter &mdash; tickit 0.1.1.pre2+12.g238c3d7 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/tickit-logo.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to accomplish a task" href="../how-to/accomplish-a-task.html" />
    <link rel="prev" title="Creating a Device" href="creating-a-device.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: rgb(7, 43, 93)" >
            <a href="../index.html" class="icon icon-home"> tickit
            <img src="../_static/tickit-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="running-a-simulation.html">Running a Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating-a-simulation.html">Creating a Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating-a-device.html">Creating a Device</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating an Adapter</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adapter-module-file">Adapter Module File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adapter-class">Adapter Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adapter-constructor-and-configuration">Adapter Constructor and Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adapter-commands">Adapter Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-adapter">Using the Adapter</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../how-to/accomplish-a-task.html">How to accomplish a task</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/how-component-updates-are-ordered.html">How component updates are ordered</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/dls-controls/tickit/blob/master/CHANGELOG.rst">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="genindex.html#http://">Index</a></li>
</ul>

  <!-- Add versions for selected branches + tags -->
  <p class="caption">
    <span class="caption-text">Versions</span>
  </p>
  <ul id="versions"/>
  <script>
    // Add any branches to appear in the side pane here, tags will be added below
    // Will only appear if docs are built and pushed in gh-pages
    var versions = ['main', 'master'];
    var dirs = new Set();
    function addVersion(name) {
      if (dirs.has(name)) {
        var li = document.createElement("li");
        var a = document.createElement("a");
        a.href = 'https://dls-controls.github.io/tickit/' + name;
        a.innerText = name;
        li.appendChild(a)
        document.getElementById('versions').appendChild(li);
      }
    }
    Promise.all([
      // Find gh-pages directories and populate `dirs`
      fetch("https://api.github.com/repos/dls-controls/tickit/contents?ref=gh-pages")
      .then(response => response.json())
      .then(data => data.forEach(function(e) {
        if (e.type == "dir") dirs.add(e.name);
      })),
      // Add tags to `versions`
      fetch('https://api.github.com/repos/dls-controls/tickit/tags')
        .then(response => response.json())
        .then(data => data.forEach(function(e) {
          versions.push(e.name);
        }))
      ]).then(_ => versions.forEach(addVersion))
  </script>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: rgb(7, 43, 93)" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">tickit</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Creating an Adapter</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/creating-an-adapter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="creating-an-adapter">
<h1>Creating an Adapter<a class="headerlink" href="#creating-an-adapter" title="Permalink to this headline"></a></h1>
<p>This tutorial shows how to create a simple <a class="reference internal" href="../reference/api.html#tickit.core.adapter.Adapter" title="tickit.core.adapter.Adapter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Adapter</span></code></a> for use in the ticket framework.
This adapter will act as a simple TCP interface to the <a class="reference internal" href="../reference/api.html#examples.devices.shutter.Shutter" title="examples.devices.shutter.Shutter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shutter</span></code></a> device which can vary
the transmission of <code class="docutils literal notranslate"><span class="pre">flux</span></code> by changing <code class="docutils literal notranslate"><span class="pre">position</span></code>. The <a class="reference internal" href="../reference/api.html#tickit.core.adapter.Adapter" title="tickit.core.adapter.Adapter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Adapter</span></code></a> we create will be
composable, meaning it will comprise of a pre-made <a class="reference internal" href="../reference/api.html#tickit.core.adapter.Server" title="tickit.core.adapter.Server"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Server</span></code></a> and <a class="reference internal" href="../reference/api.html#tickit.core.adapter.Interpreter" title="tickit.core.adapter.Interpreter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Interpreter</span></code></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See the <a class="reference internal" href="creating-a-device.html#creating-a-device"><span class="std std-ref">Creating a Device</span></a> tutorial for a walk-through of creating the <a class="reference internal" href="../reference/api.html#examples.devices.shutter.Shutter" title="examples.devices.shutter.Shutter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shutter</span></code></a>
device.</p>
</div>
<section id="adapter-module-file">
<h2>Adapter Module File<a class="headerlink" href="#adapter-module-file" title="Permalink to this headline"></a></h2>
<p>We shall begin by creating a new python module named <code class="docutils literal notranslate"><span class="pre">my_shutter_adapter.py</span></code>, and
open it with our preferred editor. This file will be used to store the our
ShutterAdapter class which will determine the operation of our adapter.</p>
</section>
<section id="adapter-class">
<h2>Adapter Class<a class="headerlink" href="#adapter-class" title="Permalink to this headline"></a></h2>
<p>We shall begin by defining the ShutterAdapter class which inherits
<a class="reference internal" href="../reference/api.html#tickit.core.adapter.Adapter" title="tickit.core.adapter.Adapter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Adapter</span></code></a> - by doing so a configuration dataclass will automatically be
created for the adapter, allowing easy YAML configuration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.core.adapter</span> <span class="kn">import</span> <span class="n">Adapter</span>

<span class="k">class</span> <span class="nc">ShutterAdapter</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>
</pre></div>
</div>
</section>
<section id="adapter-constructor-and-configuration">
<h2>Adapter Constructor and Configuration<a class="headerlink" href="#adapter-constructor-and-configuration" title="Permalink to this headline"></a></h2>
<p>Next, we shall create the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method, allowing for the adapter to be
instantiated. The first two arguments of an adapter <code class="docutils literal notranslate"><span class="pre">__init__</span></code> must be <code class="docutils literal notranslate"><span class="pre">device</span></code> of
type <code class="docutils literal notranslate"><span class="pre">Device</span></code> and <code class="docutils literal notranslate"><span class="pre">raise_interrupt</span></code> of type <code class="docutils literal notranslate"><span class="pre">Callable[[],</span> <span class="pre">Awaitable[None]]</span></code>, to
which the device the adapter acts upon and a method used to request an immediate update
of the device are passed respectively. Additionally, we will include the arguments
<code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">port</span></code> which will be used to configure our <code class="docutils literal notranslate"><span class="pre">TcpServer</span></code>. With these we
will instantiate an adapter with a <code class="docutils literal notranslate"><span class="pre">TcpServer</span></code> which formats sent messages by
appending a line break and a <code class="docutils literal notranslate"><span class="pre">CommandInterpreter</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Awaitable</span><span class="p">,</span> <span class="n">Callable</span>

<span class="kn">from</span> <span class="nn">tickit.adapters.interpreters.command.command_interpreter</span> <span class="kn">import</span> <span class="n">CommandInterpreter</span>
<span class="kn">from</span> <span class="nn">tickit.adapters.servers.tcp</span> <span class="kn">import</span> <span class="n">TcpServer</span>
<span class="kn">from</span> <span class="nn">tickit.core.adapter</span> <span class="kn">import</span> <span class="n">Adapter</span>

<span class="k">class</span> <span class="nc">ShutterAdapter</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">device</span><span class="p">:</span> <span class="n">Shutter</span><span class="p">,</span>
        <span class="n">raise_interrupt</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Awaitable</span><span class="p">[</span><span class="kc">None</span><span class="p">]],</span>
        <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25565</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">device</span><span class="p">,</span>
            <span class="n">raise_interrupt</span><span class="p">,</span>
            <span class="n">TcpServer</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">ByteFormat</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;%b</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)),</span>
            <span class="n">CommandInterpreter</span><span class="p">(),</span>
        <span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Arguments to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method may be specified in the simulation config file
if the device inherits <a class="reference internal" href="../reference/api.html#tickit.core.adapter.Adapter" title="tickit.core.adapter.Adapter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Adapter</span></code></a> (excluding <code class="docutils literal notranslate"><span class="pre">device</span></code> and
<code class="docutils literal notranslate"><span class="pre">raise_interrupt</span></code> which are injected at run-time).</p>
</div>
</section>
<section id="adapter-commands">
<h2>Adapter Commands<a class="headerlink" href="#adapter-commands" title="Permalink to this headline"></a></h2>
<p>When using the <a class="reference internal" href="../reference/api.html#tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter" title="tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">CommandInterpreter</span></code></a>, commands may be registered by decorating an
adapter method with a command register. We shall begin by creating a method which
returns the current position of the <a class="reference internal" href="../reference/api.html#examples.devices.shutter.Shutter" title="examples.devices.shutter.Shutter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shutter</span></code></a> and register it as a <a class="reference internal" href="../reference/api.html#tickit.adapters.interpreters.command.regex_command.RegexCommand" title="tickit.adapters.interpreters.command.regex_command.RegexCommand"><code class="xref any py py-class docutils literal notranslate"><span class="pre">RegexCommand</span></code></a> which
is called by sending <code class="docutils literal notranslate"><span class="pre">P?</span></code>. Since reading will not alter the device state we shall set
<code class="docutils literal notranslate"><span class="pre">interrupt</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code>. We shall also specify that the byte encoded message should
be decoded to a string prior to matching using the <code class="docutils literal notranslate"><span class="pre">utf-8</span></code> standard.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.adapters.interpreters.command.regex_command</span> <span class="kn">import</span> <span class="n">RegexCommand</span>
<span class="kn">from</span> <span class="nn">tickit.core.adapter</span> <span class="kn">import</span> <span class="n">Adapter</span>

<span class="k">class</span> <span class="nc">ShutterAdapter</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="nd">@RegexCommand</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;P\?&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="o">.</span><span class="n">position</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We shall add a similar command to read back the current target position of the
<a class="reference internal" href="../reference/api.html#examples.devices.shutter.Shutter" title="examples.devices.shutter.Shutter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shutter</span></code></a> when <code class="docutils literal notranslate"><span class="pre">T?</span></code> is recieved.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.adapters.interpreters.command.regex_command</span> <span class="kn">import</span> <span class="n">RegexCommand</span>
<span class="kn">from</span> <span class="nn">tickit.core.adapter</span> <span class="kn">import</span> <span class="n">Adapter</span>

<span class="k">class</span> <span class="nc">ShutterAdapter</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="nd">@RegexCommand</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;T\?&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_target</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="o">.</span><span class="n">target_position</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we shall add a method which sets a new target position for the <a class="reference internal" href="../reference/api.html#examples.devices.shutter.Shutter" title="examples.devices.shutter.Shutter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Shutter</span></code></a> when
<code class="docutils literal notranslate"><span class="pre">T=(\d+\.?\d*)</span></code> is recieved, where <code class="docutils literal notranslate"><span class="pre">\d+\.?\d*</span></code> denotes a decimal number and the
parentheses form the capture group from which the argument is extracted.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.adapters.interpreters.command.regex_command</span> <span class="kn">import</span> <span class="n">RegexCommand</span>
<span class="kn">from</span> <span class="nn">tickit.core.adapter</span> <span class="kn">import</span> <span class="n">Adapter</span>

<span class="k">class</span> <span class="nc">ShutterAdapter</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="nd">@RegexCommand</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;T=(\d+\.?\d*)&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="o">.</span><span class="n">target_position</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
<section id="using-the-adapter">
<h2>Using the Adapter<a class="headerlink" href="#using-the-adapter" title="Permalink to this headline"></a></h2>
<p>As explained in <a class="reference internal" href="creating-a-device.html#creating-a-device"><span class="std std-ref">Creating a Device</span></a>, an adapter allows us to control a device
externally. And in order to use the device we created a <a class="reference internal" href="../reference/api.html#tickit.core.components.component.ComponentConfig" title="tickit.core.components.component.ComponentConfig"><code class="xref any py py-class docutils literal notranslate"><span class="pre">ComponentConfig</span></code></a> for said
device. This is defined in the same file as the device and adapter, and defines any
default initial configuration values. As well as this, we override the magic method
<a class="reference internal" href="../reference/api.html#tickit.utils.singleton.Singleton.__call__" title="tickit.utils.singleton.Singleton.__call__"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">__call__()</span></code></a>, which return a <a class="reference internal" href="../reference/api.html#tickit.core.components.device_simulation.DeviceSimulation" title="tickit.core.components.device_simulation.DeviceSimulation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">DeviceSimulation</span></code></a> object. In the <a class="reference internal" href="../reference/api.html#tickit.core.components.device_simulation.DeviceSimulation" title="tickit.core.components.device_simulation.DeviceSimulation"><code class="xref any py py-class docutils literal notranslate"><span class="pre">DeviceSimulation</span></code></a>
object, we also define the device’s adapter(s):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Shutter</span><span class="p">(</span><span class="n">ComponentConfig</span><span class="p">):</span>

    <span class="n">default_position</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">initial_position</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25565</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">DeviceSimulation</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="n">ShutterDevice</span><span class="p">(</span>
                <span class="n">default_position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default_position</span><span class="p">,</span>
                <span class="n">initial_position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_position</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">adapters</span><span class="o">=</span><span class="p">[</span><span class="n">ShutterAdapter</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)],</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>Using <a class="reference internal" href="../reference/api.html#tickit.core.components.component.ComponentConfig" title="tickit.core.components.component.ComponentConfig"><code class="xref any py py-class docutils literal notranslate"><span class="pre">ComponentConfig</span></code></a> the adapters are instantiated in Python so they are not referenced in the YAML config.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See the <a class="reference internal" href="creating-a-simulation.html#creating-a-simulation"><span class="std std-ref">Creating a Simulation</span></a> tutorial for a walk-through of creating simulation
configurations.</p>
</div>
<p>We may then run the simulation, this may be performed by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -m tickit all my_shutter_simulation.yaml
</pre></div>
</div>
<p>Additionally, we will start a telnet client which communicates with the TcpServer of
the adapter, this may be performed by running the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>telnet localhost <span class="m">25565</span>
</pre></div>
</div>
<p>When run we expect a response akin to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Trying ::1...
Connected to localhost.
Escape character is <span class="se">\&#39;</span>^<span class="o">]</span><span class="se">\&#39;</span>.
</pre></div>
</div>
<p>From this telnet client we can send various messages and recieve responses from our
adapter. Examples of getting the position and target with <code class="docutils literal notranslate"><span class="pre">P?</span></code> and <code class="docutils literal notranslate"><span class="pre">T?</span></code> are shown
below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>P?
<span class="m">0</span>.2
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>T?
<span class="m">0</span>.2
</pre></div>
</div>
<p>Finally, we may wish to set a new target with <code class="docutils literal notranslate"><span class="pre">T=</span></code>, an example of this with the value
0.16 is shown below, with accompanying tickit debug output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">T</span><span class="o">=</span><span class="m">0</span>.16
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DEBUG:tickit.adapters.servers.tcp:Recieved b<span class="s1">&#39;T=0.16\r\n&#39;</span> from <span class="o">(</span><span class="s1">&#39;::1&#39;</span>, <span class="m">33096</span>, <span class="m">0</span>, <span class="m">0</span><span class="o">)</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Interrupt<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span><span class="o">)</span>
DEBUG:tickit.core.management.schedulers.base:Scheduling Wakeup<span class="o">(</span><span class="nv">component</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">when</span><span class="o">=</span><span class="m">209786950024</span><span class="o">)</span>
DEBUG:tickit.core.management.ticker:Doing tick @ <span class="m">209786950024</span>
DEBUG:tickit.core.components.component:shutter got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209786950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({}))</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209786950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({})</span>, <span class="nv">call_in</span><span class="o">=</span><span class="m">100000000</span><span class="o">)</span>
DEBUG:tickit.core.management.schedulers.base:Scheduling Wakeup<span class="o">(</span><span class="nv">component</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">when</span><span class="o">=</span><span class="m">209886950024</span><span class="o">)</span>
DEBUG:tickit.core.components.component:sink got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209786950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({}))</span>
DEBUG:tickit.devices.sink:Sunk <span class="o">{</span><span class="s1">&#39;flux&#39;</span>: <span class="m">8</span>.4<span class="o">}</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209786950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({})</span>, <span class="nv">call_in</span><span class="o">=</span>None<span class="o">)</span>
DEBUG:tickit.core.management.ticker:Doing tick @ <span class="m">209886950024</span>
DEBUG:tickit.core.components.component:shutter got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209886950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({}))</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209886950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>: <span class="m">7</span>.5600000000000005<span class="o">})</span>, <span class="nv">call_in</span><span class="o">=</span><span class="m">100000000</span><span class="o">)</span>
DEBUG:tickit.core.management.schedulers.base:Scheduling Wakeup<span class="o">(</span><span class="nv">component</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">when</span><span class="o">=</span><span class="m">209986950024</span><span class="o">)</span>
DEBUG:tickit.core.components.component:sink got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209886950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>: <span class="m">7</span>.5600000000000005<span class="o">}))</span>
DEBUG:tickit.devices.sink:Sunk <span class="o">{</span><span class="s1">&#39;flux&#39;</span>: <span class="m">7</span>.5600000000000005<span class="o">}</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209886950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({})</span>, <span class="nv">call_in</span><span class="o">=</span>None<span class="o">)</span>
DEBUG:tickit.core.management.ticker:Doing tick @ <span class="m">209986950024</span>
DEBUG:tickit.core.components.component:shutter got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209986950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({}))</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209986950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>: <span class="m">6</span>.7200000000000015<span class="o">})</span>, <span class="nv">call_in</span><span class="o">=</span><span class="m">100000000</span><span class="o">)</span>
DEBUG:tickit.core.management.schedulers.base:Scheduling Wakeup<span class="o">(</span><span class="nv">component</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">when</span><span class="o">=</span><span class="m">210086950024</span><span class="o">)</span>
DEBUG:tickit.core.components.component:sink got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209986950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>: <span class="m">6</span>.7200000000000015<span class="o">}))</span>
DEBUG:tickit.devices.sink:Sunk <span class="o">{</span><span class="s1">&#39;flux&#39;</span>: <span class="m">6</span>.7200000000000015<span class="o">}</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">209986950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({})</span>, <span class="nv">call_in</span><span class="o">=</span>None<span class="o">)</span>
DEBUG:tickit.core.management.ticker:Doing tick @ <span class="m">210086950024</span>
DEBUG:tickit.core.components.component:shutter got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">210086950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({}))</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;shutter&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">210086950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>: <span class="m">6</span>.72<span class="o">})</span>, <span class="nv">call_in</span><span class="o">=</span>None<span class="o">)</span>
DEBUG:tickit.core.components.component:sink got Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">210086950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>: <span class="m">6</span>.72<span class="o">}))</span>
DEBUG:tickit.devices.sink:Sunk <span class="o">{</span><span class="s1">&#39;flux&#39;</span>: <span class="m">6</span>.72<span class="o">}</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler got Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>, <span class="nv">time</span><span class="o">=</span><span class="m">210086950024</span>, <span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({})</span>, <span class="nv">call_in</span><span class="o">=</span>None<span class="o">)</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See the <a class="reference internal" href="running-a-simulation.html#running-a-simulation"><span class="std std-ref">Running a Simulation</span></a> tutorial for a walk-through of running a simulation
in a single or across multiple processes.</p>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="creating-a-device.html" class="btn btn-neutral float-left" title="Creating a Device" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../how-to/accomplish-a-task.html" class="btn btn-neutral float-right" title="How to accomplish a task" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Diamond Light Source.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>