

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Simulate a Single Simple Device &#8212; tickit 0.2.1.dev15+ge3244c1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/how-to/simulate-a-single-simple-device';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://dls-controls.github.io/tickit/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'update_docs';
        </script>
    <link rel="shortcut icon" href="../../_static/tickit-logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Create a Device with an EPICS Interface" href="use-epics-adapter.html" />
    <link rel="prev" title="Creating a Device" href="create-a-device.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/tickit-logo.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/tickit-logo.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">tickit</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/dls-controls/tickit/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/dls-controls/tickit" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/tickit" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      update_docs  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../developer/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://github.com/dls-controls/tickit/releases">
                    Release Notes
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/dls-controls/tickit" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/tickit" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fas fa-cube"></i></span>
            <label class="sr-only">PyPI</label></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button type="button" class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle" data-bs-toggle="dropdown">
      update_docs  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div class="version-switcher__menu dropdown-menu list-group-flush py-0">
    <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/running-a-simulation.html">Running a Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/creating-a-simulation.html">Creating a Simulation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="create-a-device.html">Creating a Device</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Simulate a Single Simple Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="use-epics-adapter.html">Create a Device with an EPICS Interface</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../explanations/framework-summary.html">Framework Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/components.html">Simulation Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/devices.html">Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/adapters.html">Adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/wiring.html">Wiring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../explanations/glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../genindex.html">Index</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Simulate a Single Simple Device</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="simulate-a-single-simple-device">
<h1>Simulate a Single Simple Device<a class="headerlink" href="#simulate-a-single-simple-device" title="Permalink to this heading">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There is currently a bug which affects the interaction between isolated
components and the scheduler. This can be worked around by linking your
component to a sink. See below for <a class="reference internal" href="#bug-issue">Bug issue</a> details.</p>
</div>
<p>This tutorial shows a user how to create a very simple device and run it in its
own simulation.</p>
<p>In this tutorial we will:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#create-a-new-device">Create a new device</a></p></li>
<li><p><a class="reference internal" href="#attach-an-adapter-to-the-device">Attach an adapter to the device</a></p></li>
<li><p><a class="reference internal" href="#create-the-component-for-the-device-and-adapter">Create the component for the device and adapter</a></p></li>
<li><p><a class="reference internal" href="#write-the-config-yaml-file-to-run-the-simulation">Write the config yaml file to run the simulation</a></p></li>
</ol>
<p>Following these steps will result in the following simulated system:</p>
<figure class="align-center">
<img alt="../../_images/tickit-simple-simulation.svg" src="../../_images/tickit-simple-simulation.svg" /></figure>
<section id="create-a-new-device">
<h2>Create a new device<a class="headerlink" href="#create-a-new-device" title="Permalink to this heading">#</a></h2>
<p>Any new device created must: be of type device, have an update method, and must
have <strong>Inputs</strong> and <strong>Outputs</strong> maps as members. In this tutorial we will not
be connecting the device to any other, it will be running in isolation. As a
result the the Inputs and Outputs of this device will be empty, however they
must still be present in the device class.</p>
<p>Initially we set up the boilerplate.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.core.device</span> <span class="kn">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">DeviceUpdate</span>
<span class="kn">from</span> <span class="nn">tickit.core.typedefs</span> <span class="kn">import</span> <span class="n">SimTime</span>
<span class="kn">from</span> <span class="nn">tickit.utils.compat.typing_compat</span> <span class="kn">import</span> <span class="n">TypedDict</span>


<span class="k">class</span> <span class="nc">IoCountingDevice</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>

<span class="c1">#: An empty typed mapping of device inputs</span>
<span class="n">Inputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Inputs&quot;</span><span class="p">,</span> <span class="p">{})</span>
<span class="c1">#: A typed mapping containing the current output value</span>
<span class="n">Outputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Outputs&quot;</span><span class="p">,</span> <span class="p">{})</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">SimTime</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeviceUpdate</span><span class="p">[</span><span class="n">Outputs</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">DeviceUpdate</span><span class="p">(</span><span class="n">IoBoxDevice</span><span class="o">.</span><span class="n">Outputs</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>This device we have called IoBoxDevice currently does nothing. It takes no
inputs, provides no outputs and has no attributes that are initialised. Since
we need a device to do something we will make it recieve messages and store it
(until a new one comes along). To do so we can give it an attribute <strong>message</strong>
that is initialised as “Hello”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.core.device</span> <span class="kn">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">DeviceUpdate</span>
<span class="kn">from</span> <span class="nn">tickit.core.typedefs</span> <span class="kn">import</span> <span class="n">SimTime</span>
<span class="kn">from</span> <span class="nn">tickit.utils.compat.typing_compat</span> <span class="kn">import</span> <span class="n">TypedDict</span>


<span class="k">class</span> <span class="nc">IoCountingDevice</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>

<span class="c1">#: An empty typed mapping of device inputs</span>
<span class="n">Inputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Inputs&quot;</span><span class="p">,</span> <span class="p">{})</span>
<span class="c1">#: A typed mapping containing the current output value</span>
<span class="n">Outputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Outputs&quot;</span><span class="p">,</span> <span class="p">{})</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inital_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">inital_value</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">SimTime</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeviceUpdate</span><span class="p">[</span><span class="n">Outputs</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">DeviceUpdate</span><span class="p">(</span><span class="n">IoCountingDevice</span><span class="o">.</span><span class="n">Outputs</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>Say for some reason we are also interested in how many times the device has
been updated overall. We can do this by initalising another class attribute
<strong>update_count</strong> and having it incremented everytime the device is updated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.core.device</span> <span class="kn">import</span> <span class="n">Device</span><span class="p">,</span> <span class="n">DeviceUpdate</span>
<span class="kn">from</span> <span class="nn">tickit.core.typedefs</span> <span class="kn">import</span> <span class="n">SimTime</span>
<span class="kn">from</span> <span class="nn">tickit.utils.compat.typing_compat</span> <span class="kn">import</span> <span class="n">TypedDict</span>


<span class="k">class</span> <span class="nc">IoCountingDevice</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>

<span class="c1">#: An empty typed mapping of device inputs</span>
<span class="n">Inputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Inputs&quot;</span><span class="p">,</span> <span class="p">{})</span>
<span class="c1">#: A typed mapping containing the current output value</span>
<span class="n">Outputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Outputs&quot;</span><span class="p">,</span> <span class="p">{})</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inital_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">inital_value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_count</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">SimTime</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeviceUpdate</span><span class="p">[</span><span class="n">Outputs</span><span class="p">]:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">update_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_count</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">DeviceUpdate</span><span class="p">(</span><span class="n">IoCountingDevice</span><span class="o">.</span><span class="n">Outputs</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>For more complicated behaviour you can put logic in the update method and even
call other class functions to manipulate the attributes of the device however
is needed. See the included example devices as a guide.</p>
<p>Now we need a way to give our device a message, we can do so with an adapter.</p>
</section>
<section id="attach-an-adapter-to-the-device">
<h2>Attach an adapter to the device<a class="headerlink" href="#attach-an-adapter-to-the-device" title="Permalink to this heading">#</a></h2>
<p>An adapter facilitaties interactions between a device and components external
to the simulation. In this tutorial we will use a <a class="reference internal" href="../reference/api.html#tickit.adapters.composed.ComposedAdapter" title="tickit.adapters.composed.ComposedAdapter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">ComposedAdapter</span></code></a>. Being
composable means it will comprise of a pre-made server and interpreter, delegating
the hosting of an external messaging protocol to a server, and message handling
to an interpreter. Here we wish to use a TCP server and a <a class="reference internal" href="../reference/api.html#tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter" title="tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">CommandInterpreter</span></code></a>
so that we may send the device messages via a TCP client.</p>
<p>The required interpreter and server are initialised with the adapter. We can
keep the server generic for now, but provide the <a class="reference internal" href="../reference/api.html#tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter" title="tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">CommandInterpreter</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.adapters.composed</span> <span class="kn">import</span> <span class="n">ComposedAdapter</span>
<span class="kn">from</span> <span class="nn">tickit.adapters.interpreters.command</span> <span class="kn">import</span> <span class="n">CommandInterpreter</span>
<span class="kn">from</span> <span class="nn">tickit.core.adapter</span> <span class="kn">import</span> <span class="n">Server</span>


<span class="k">class</span> <span class="nc">IoCountingAdapater</span><span class="p">(</span><span class="n">ComposedAdapter</span><span class="p">):</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">IoCountingDevice</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">:</span> <span class="n">Server</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">server</span><span class="p">,</span>
            <span class="n">CommandInterpreter</span><span class="p">(),</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>When using the CommandInterpreter, commands may be registered by decorating an
adapter method with a command register.</p>
<p>The <a class="reference internal" href="../reference/api.html#tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter" title="tickit.adapters.interpreters.command.command_interpreter.CommandInterpreter"><code class="xref any py py-class docutils literal notranslate"><span class="pre">CommandInterpreter</span></code></a> interprets messages recived by the server using regex
commands to check the message is something the device wants to handle. Should the
command match, the method is called. We will allow ours to recieve very general
messages:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tickit.adapters.composed</span> <span class="kn">import</span> <span class="n">ComposedAdapter</span>
<span class="kn">from</span> <span class="nn">tickit.adapters.interpreters.command</span> <span class="kn">import</span> <span class="n">CommandInterpreter</span>
<span class="kn">from</span> <span class="nn">tickit.core.adapter</span> <span class="kn">import</span> <span class="n">Server</span>


<span class="k">class</span> <span class="nc">IoCountingAdapater</span><span class="p">(</span><span class="n">ComposedAdapter</span><span class="p">):</span>
    <span class="n">device</span><span class="p">:</span> <span class="n">IoCountingDevice</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">:</span> <span class="n">Server</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">server</span><span class="p">,</span>
            <span class="n">CommandInterpreter</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@RegexCommand</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;m=([a-zA-Z0-9_!.?-]+)&quot;</span><span class="p">,</span> <span class="n">interrupt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@RegexCommand</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;m\?&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">message</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we have created two commands for our interpreter, one for setting the value
of the message and and one for getting the message. See the following line:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@RegexCommand</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;m=([a-zA-Z0-9_!.?-]+)&quot;</span><span class="p">,</span> <span class="n">interrupt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With this line we register this adapter method as a command so that it is called
if <code class="docutils literal notranslate"><span class="pre">m=([a-zA-Z0-9_!.?-]+)</span></code> is recieved. Here <code class="docutils literal notranslate"><span class="pre">[a-zA-Z0-9_!.?-]+</span></code> denotes alpha
numberic charaters and some punctuation and forms the capture groups <code class="docutils literal notranslate"><span class="pre">()</span></code> for
the message. As a result any message recieved which preceedes with <strong>m=</strong> and
containing characters in the above regex capture group will be stored in the
device with <code class="docutils literal notranslate"><span class="pre">self.device.message</span> <span class="pre">=</span> <span class="pre">value</span></code>.</p>
<p>To then query the device for the message we use the command <strong>m?</strong> and the
server will return the current value of <strong>message</strong> on the device.</p>
</section>
<section id="create-the-component-for-the-device-and-adapter">
<h2>Create the component for the device and adapter<a class="headerlink" href="#create-the-component-for-the-device-and-adapter" title="Permalink to this heading">#</a></h2>
<p>In order to now run the device in a simulation we must make a component for it
and the adapter.</p>
<p>The basic format of a component is a follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">tickit.core.components.component</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">ComponentConfig</span>
<span class="kn">from</span> <span class="nn">tickit.core.components.device_simulation</span> <span class="kn">import</span> <span class="n">DeviceSimulation</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IoCounter</span><span class="p">(</span><span class="n">ComponentConfig</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>  <span class="c1"># noqa: D102</span>
        <span class="k">return</span> <span class="n">DeviceSimulation</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>This is an empty component called <code class="docutils literal notranslate"><span class="pre">IoCounter</span></code> whos only atribute is it’s name.
To add the device and adapter we include those as arguments to the <a class="reference internal" href="../reference/api.html#tickit.utils.singleton.Singleton.__call__" title="tickit.utils.singleton.Singleton.__call__"><code class="xref any py py-meth docutils literal notranslate"><span class="pre">__call__</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">tickit.core.components.component</span> <span class="kn">import</span> <span class="n">Component</span><span class="p">,</span> <span class="n">ComponentConfig</span>
<span class="kn">from</span> <span class="nn">tickit.core.components.device_simulation</span> <span class="kn">import</span> <span class="n">DeviceSimulation</span>
<span class="kn">from</span> <span class="nn">tickit.adapters.servers.tcp</span> <span class="kn">import</span> <span class="n">TcpServer</span>
<span class="kn">from</span> <span class="nn">tickit.utils.byte_format</span> <span class="kn">import</span> <span class="n">ByteFormat</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IoCounter</span><span class="p">(</span><span class="n">ComponentConfig</span><span class="p">):</span>

    <span class="n">host</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25565</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">ByteFormat</span> <span class="o">=</span> <span class="n">ByteFormat</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;%b</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Component</span><span class="p">:</span>  <span class="c1"># noqa: D102</span>
        <span class="k">return</span> <span class="n">DeviceSimulation</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="n">IoCountingDevice</span><span class="p">(),</span>
            <span class="n">adapters</span><span class="o">=</span><span class="p">[</span><span class="n">IoCountingAdapater</span><span class="p">(</span><span class="n">TcpServer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">))],</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>In order to initialise the TCP server we need a host, port and message format.
These can be provided as class attributes but are also able to be assigned from
default values provided in the configuration yaml.</p>
<p>(Note: If the device and adapter are not in the same file as the component they
will also need importing.)</p>
</section>
<section id="write-the-config-yaml-file-to-run-the-simulation">
<h2>Write the config yaml file to run the simulation<a class="headerlink" href="#write-the-config-yaml-file-to-run-the-simulation" title="Permalink to this heading">#</a></h2>
<p>Now we want to run our simulation and talk to our device over a TCP connection.</p>
<p>In order to do so we must first write the config file to run the simulation.
This file will look something like below:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">examples.devices.my_new_device.IoCounter</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MrBox</span>
<span class="w">    </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25565</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</pre></div>
</div>
<p>Here the first line is the component initialisation and requires the traversal
of the module directory to the component. Following that is name of the component
and the list of its inputs, which in this case is blank.</p>
<p>The simulation can now be run with the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>-m<span class="w"> </span>tickit<span class="w"> </span>all<span class="w"> </span>path/to/IoCounter_config.yaml
</pre></div>
</div>
<p>Additionally we will need to start up a client to communicate with the TCP server
of the adapter. We will use the telnet client which can be started with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>telnet<span class="w"> </span>localhost<span class="w"> </span><span class="m">25565</span>
</pre></div>
</div>
<p>When we run this command we expect a response akin to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Trying<span class="w"> </span>::1...
Connected<span class="w"> </span>to<span class="w"> </span>localhost.
Escape<span class="w"> </span>character<span class="w"> </span>is<span class="w"> </span><span class="se">\&#39;</span>^<span class="o">]</span><span class="se">\&#39;</span>.
</pre></div>
</div>
<p>From this telnet client we can send messages and recieve responses from our
adapter. To query the message on the device we use the <code class="docutils literal notranslate"><span class="pre">m?</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>m?
Hello
</pre></div>
</div>
<p>Which returns the message we initialised our device with. In order to set a new
message we use the <code class="docutils literal notranslate"><span class="pre">m=</span></code> sytnax to set:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">m</span><span class="o">=</span>LOUDHELLO
</pre></div>
</div>
<p>And if we now want to check the message again, the device will return its latest
message.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>m?
LOUDHELLO
</pre></div>
</div>
</section>
<section id="bug-issue">
<h2>Bug issue<a class="headerlink" href="#bug-issue" title="Permalink to this heading">#</a></h2>
<p>There is currently an issue with the running of isolated components, such as the
one made in this tutorial. The result of this bug being that any component not
wired to another one, ie one with no inputs or outputs, is invisible to the
scheduler. It does not get updated and feels no passage of time (very unhelpful).</p>
<p>The solution to this for now is to make your device produce some kind of output
and have that output piped into a sink. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">IoCountingDevice</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>

    <span class="c1">#: An empty typed mapping of device inputs</span>
    <span class="n">Inputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Inputs&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="c1">#: A typed mapping containing the current output value</span>
    <span class="n">Outputs</span><span class="p">:</span> <span class="n">TypedDict</span> <span class="o">=</span> <span class="n">TypedDict</span><span class="p">(</span><span class="s2">&quot;Outputs&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inital_value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">inital_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">SimTime</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="n">Inputs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeviceUpdate</span><span class="p">[</span><span class="n">Outputs</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">DeviceUpdate</span><span class="p">(</span><span class="n">IoCountingDevice</span><span class="o">.</span><span class="n">Outputs</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>With the config written as such:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">examples.devices.iobox.IoBox</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MrBox</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tickit.devices.sink.Sink</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sink</span>
<span class="w">    </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">flux</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MrBox:message</span>
</pre></div>
</div>
<p>when the simulation is run <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">tickit</span> <span class="pre">all</span> <span class="pre">path/to/IoCounter_config.yaml</span></code>
you will see the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DEBUG:asyncio:Using<span class="w"> </span>selector:<span class="w"> </span>EpollSelector
DEBUG:tickit.core.management.ticker:Doing<span class="w"> </span>tick<span class="w"> </span>@<span class="w"> </span><span class="m">0</span>
DEBUG:tickit.core.components.component:MrBox<span class="w"> </span>got<span class="w"> </span>Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;MrBox&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({}))</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler<span class="w"> </span>got<span class="w"> </span>Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;MrBox&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;message&#39;</span>:<span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="o">})</span>,<span class="w"> </span><span class="nv">call_at</span><span class="o">=</span>None<span class="o">)</span>
DEBUG:tickit.core.components.component:sink<span class="w"> </span>got<span class="w"> </span>Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>:<span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="o">}))</span>
DEBUG:tickit.devices.sink:Sunk<span class="w"> </span><span class="o">{</span><span class="s1">&#39;flux&#39;</span>:<span class="w"> </span><span class="s1">&#39;Hello&#39;</span><span class="o">}</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler<span class="w"> </span>got<span class="w"> </span>Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({})</span>,<span class="w"> </span><span class="nv">call_at</span><span class="o">=</span>None<span class="o">)</span>
</pre></div>
</div>
<p>Then if you query it with telnet <code class="docutils literal notranslate"><span class="pre">m?</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DEBUG:tickit.adapters.servers.tcp:Recieved<span class="w"> </span>b<span class="s1">&#39;m?\r\n&#39;</span><span class="w"> </span>from<span class="w"> </span><span class="o">(</span><span class="s1">&#39;127.0.0.1&#39;</span>,<span class="w"> </span><span class="m">38986</span><span class="o">)</span>
DEBUG:tickit.adapters.servers.tcp:Replying<span class="w"> </span>with<span class="w"> </span>b<span class="s1">&#39;Hello&#39;</span>
</pre></div>
</div>
<p>Setting the new value <code class="docutils literal notranslate"><span class="pre">m=LOUDHELLO</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DEBUG:tickit.adapters.servers.tcp:Recieved<span class="w"> </span>b<span class="s1">&#39;m=LOUNDHELLO\r\n&#39;</span><span class="w"> </span>from<span class="w"> </span><span class="o">(</span><span class="s1">&#39;127.0.0.1&#39;</span>,<span class="w"> </span><span class="m">38986</span><span class="o">)</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler<span class="w"> </span>got<span class="w"> </span>Interrupt<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;MrBox&#39;</span><span class="o">)</span>
DEBUG:tickit.core.management.schedulers.base:Scheduling<span class="w"> </span>MrBox<span class="w"> </span><span class="k">for</span><span class="w"> </span>wakeup<span class="w"> </span>at<span class="w"> </span><span class="m">88696390177</span>
DEBUG:tickit.core.management.ticker:Doing<span class="w"> </span>tick<span class="w"> </span>@<span class="w"> </span><span class="m">88696390177</span>
DEBUG:tickit.core.components.component:MrBox<span class="w"> </span>got<span class="w"> </span>Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;MrBox&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">88696390177</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({}))</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler<span class="w"> </span>got<span class="w"> </span>Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;MrBox&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">88696390177</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;message&#39;</span>:<span class="w"> </span><span class="s1">&#39;LOUNDHELLO&#39;</span><span class="o">})</span>,<span class="w"> </span><span class="nv">call_at</span><span class="o">=</span>None<span class="o">)</span>
DEBUG:tickit.core.components.component:sink<span class="w"> </span>got<span class="w"> </span>Input<span class="o">(</span><span class="nv">target</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">88696390177</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({</span><span class="s1">&#39;flux&#39;</span>:<span class="w"> </span><span class="s1">&#39;LOUNDHELLO&#39;</span><span class="o">}))</span>
DEBUG:tickit.devices.sink:Sunk<span class="w"> </span><span class="o">{</span><span class="s1">&#39;flux&#39;</span>:<span class="w"> </span><span class="s1">&#39;LOUNDHELLO&#39;</span><span class="o">}</span>
DEBUG:tickit.core.management.schedulers.base:Scheduler<span class="w"> </span>got<span class="w"> </span>Output<span class="o">(</span><span class="nv">source</span><span class="o">=</span><span class="s1">&#39;sink&#39;</span>,<span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">88696390177</span>,<span class="w"> </span><span class="nv">changes</span><span class="o">=</span>immutables.Map<span class="o">({})</span>,<span class="w"> </span><span class="nv">call_at</span><span class="o">=</span>None<span class="o">)</span>
</pre></div>
</div>
<p>Then querying the new <code class="docutils literal notranslate"><span class="pre">m?</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>DEBUG:tickit.adapters.servers.tcp:Recieved<span class="w"> </span>b<span class="s1">&#39;m?\r\n&#39;</span><span class="w"> </span>from<span class="w"> </span><span class="o">(</span><span class="s1">&#39;127.0.0.1&#39;</span>,<span class="w"> </span><span class="m">38986</span><span class="o">)</span>
DEBUG:tickit.adapters.servers.tcp:Replying<span class="w"> </span>with<span class="w"> </span>b<span class="s1">&#39;LOUNDHELLO&#39;</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="create-a-device.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Creating a Device</p>
      </div>
    </a>
    <a class="right-next"
       href="use-epics-adapter.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Create a Device with an EPICS Interface</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-new-device">Create a new device</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#attach-an-adapter-to-the-device">Attach an adapter to the device</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-component-for-the-device-and-adapter">Create the component for the device and adapter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#write-the-config-yaml-file-to-run-the-simulation">Write the config yaml file to run the simulation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bug-issue">Bug issue</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  
  <div class="tocsection editthispage">
    <a href="https://github.com/dls-controls/tickit/edit/update_docs/docs/user/how-to/simulate-a-single-simple-device.rst">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/user/how-to/simulate-a-single-simple-device.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner"></div>
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>